<!DOCTYPE html>
<html lang="en-us">

<head>
    <title>Quiz</title>
    <!-- CSS Sheet -->
    <link rel="stylesheet" href="css/style.css">
    <!-- font link -->
    <link href="https://fonts.googleapis.com/css?family=Lato|Orbitron&display=swap" rel="stylesheet">
    <!-- Bootstrap Link -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
        integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">

</head>

<body>
    <% include ../partials/nav %>
    <div class="box">
        <h1>QuizyQuiz</h1>
        <br>
        <div class="quiz-timer form-group">
            <input class="form-control" id="playerName" name="name" type="text" placeholder="Name">
            <div class="quiz">
                <button class="btn btn-success" id="go">Go!</button>
            </div>
        </div>
    </div>




    <!-- Modal -->
    <div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
        aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">Congrats, You were in the top 5 highest players!</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body" id="winDiv">
                    <h2>You can leave a message below that will appear on the LEADERPAGE</h2>

                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary">Save changes</button>
                </div>
            </div>
        </div>
    </div>


    <!-- jquery link -->
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
        integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
        crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"
        integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"
        crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
        integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
        crossorigin="anonymous"></script>
    <!-- js file link -->
    <script type="text/javascript">
        var timer
        var quizArea = $('.quiz')
        var q = [];
        function questionGen() {
            for (var i = 0; i < 5; i++) {
                q.push(parseInt([Math.floor(Math.random() * 48) + 1]))
                console.log(q)
            }
        }
        questionGen();

        var rules = {
            right: 0,
            wrong: 0,
            counter: 50,
            timer: function () {
                rules.counter--;
                if (rules.counter == 0) { alert('Time up!') }
                $("#countdown").text(rules.counter + " Seconds");
            },
            go: function () {
                $('#go').remove();
                timer = setInterval(rules.timer, 1000)
                $(".quiz-timer").append(
                    "<h3 id='counterArea'> Time left: <p id='countdown'>50 Seconds<p> </h3>"
                )
                $.ajax({
                    url: '/questions',
                    method: 'GET'
                }).then(function (res) {
                    for (var i = 0; i < 5; i++) {
                        var thisQ = q[i]
                        // console.log
                        // debugger;
                        quizArea.append("<h3>" + res[thisQ].question + "</h3>");
                        quizArea.append("<br><br><input type='radio' name='question-" + i +
                            "' value='" + res[thisQ].answer1 + "''>" + res[thisQ].answer1);
                        quizArea.append("<br><br><input type='radio' name='question-" + i +
                            "' value='" + res[thisQ].answer2 + "''>" + res[thisQ].answer2);
                        quizArea.append("<br><br><input type='radio' name='question-" + i +
                            "' value='" + res[thisQ].answer3 + "''>" + res[thisQ].answer3);
                        quizArea.append("<br><br><input type='radio' name='question-" + i +
                            "' value='" + res[thisQ].answer4 + "''>" + res[thisQ].answer4);
                    }
                    quizArea.append("<br><br><br><button id='stop'>Stop</button>");
                }
                )



            },
            stop: function () {
                $(".quiz-timer").append(
                    "<h3> You completed the quiz with only</h3> <h3 id='finalCountdown'>50 Seconds</h3><h3> left!</h3>"
                )
                // debugger;
                var inputs = quizArea.children("input:checked");
                var stopQ = 4

                var that = this;
                // debugger;
                $.ajax({
                    url: '/questions',
                    method: 'GET'
                }).then(function (res) {
                    // debugger;
                    for (var i = 0; i < 5; i++) {
                        // debugger;
                        var thisQ = q[i]
                        console.log("ThisQ is " + thisQ)
                        console.log("res[thisQ].answer1 is " + res[thisQ].answer1)
                        q.push(thisQ)
                        var answers = []
                        answers.push(res[thisQ].answer1)
                        answers.push(res[thisQ].answer2)
                        answers.push(res[thisQ].answer3)
                        answers.push(res[thisQ].answer4)
                        console.log("These are all the answers " + answers)
                        var answer = res[thisQ].correct_answer
                        console.log(answer + " is turned into " + answers[answer - 1])
                        console.log($(inputs[i]).val() + " is the chosen answer")
                        if ($(inputs[i]).val() == answers[answer - 1]) {
                            console.log("+1 Right answer")
                            that.right++;
                        } else {
                            console.log("+1 Wrong answer")
                            rules.wrong++;
                            console.log(that.wrong)
                        }
                        if (stopQ == 4) {
                            debugger;
                            that.score();
                        }
                    }

                }
                )



            },
            score: function () {
                console.log(this.right)
                // debugger;
                $("#counterArea").html(" ")
                clearInterval(timer);
                $('#finalCountdown').text(this.counter + " seconds")
                quizArea.html("<h2>Congrats!</h2>");
                quizArea.append("<h3>Right Answers: " + this.right + "</h3>");
                quizArea.append("<h3>Wrong Answers: " + this.wrong + "</h3>");
                $('#exampleModal').modal('show')
                this.insertscore();
            },
            win: function () {

                $('#winDiv').append('<input class="form-control" id="commInput" type="text" placeholder="Leave a Comment Here">')
                $('#exampleModal').modal('show')
            },
            insertscore: function () {
                // debugger;
                // event.preventDefault();

                console.log($("input#commInput").value);
                var pn = $("input#commInput").value;
                var ps =

                    $.ajax({
                        url: '/insert',
                        method: 'POST',
                        data: {
                            comment: pn,
                            comm_id: pt
                        }
                    }).then(function (res) {
                        console.log("Insert AJAX ran.")
                    });
            },
            insertcomment: function () {

            }

        }

        $(document).on("click", "#go", function () {
            rules.go();
        });
        $(document).on("click", "#stop", function () {
            rules.stop();
        });

        function showComments() {
            $('div').empty();


        }
    </script>
</body>

</html>